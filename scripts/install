#!/bin/bash

source /usr/share/yunohost/helpers

if [ $rainradar -eq 1 ]; then
	ynh_script_progression --message="install rainradar" --weight=1
	yunohost app install "https://github.com/siwinter/rainradar2_ynh" --force

else
	ynh_script_progression --message="rainradar 2" --weight=1
fi

ynh_script_progression --message="rainradar 1  $petrol" --weight=1

#=================================================
# DOWNLOAD, CHECK AND UNPACK SOURCE
#=================================================
ynh_script_progression --message="Setting up source files..." --weight=1

### `ynh_setup_source` is used to install an app from a zip or tar.gz file,
### downloaded from an upstream source, like a git repository.
### `ynh_setup_source` use the file conf/app.src

# Download, check integrity, uncompress and patch the source from app.src
ynh_setup_source --dest_dir="$install_dir"

echo "Hello world!" > $install_dir/index.html

# $install_dir will automatically be initialized with some decent 
# permission by default ... however, you may need to recursively reapply
# ownership to all files such as after the ynh_setup_source step
chown -R $app:www-data "$install_dir"

chown -R www-data: "$install_dir"

#=================================================
# NGINX CONFIGURATION
#=================================================
ynh_script_progression --message="Configuring nginx web server..." --weight=1

# Create a dedicated nginx config
ynh_add_nginx_config

#=================================================
# ADD SERVICE MOSQUITTO TO ADMIN PANEL
#=================================================

#yunohost service add mosquitto --log "/var/log/mosquitto/mosquitto.log"

#cp ../conf/wg0.conf /etc/wireguard/wg0.conf
#systemctl enable wg-quick@wg0

# allow IP-Forwarding
#sed -i s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g /etc/sysctl.conf
#sysctl -p
